<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Glowie â€” ì˜¬ë¦¬ë¸Œì˜ ì œí’ˆ ìˆ˜ì§‘ê¸°</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Fraunces:opsz,wght@9..144,700&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0F0F0F;--surf:#1A1A1A;--surf2:#222;--bord:#2E2E2E;
  --ink:#F5F3EF;--ink2:#A0A0A0;--ink3:#505050;
  --acc:#C8815A;--accL:rgba(200,129,90,.15);
  --grn:#4A9C6A;--grnL:rgba(74,156,106,.15);
  --red:#E05555;--redL:rgba(224,85,85,.12);
  --purple:#8B7CF6;--purpleL:rgba(139,124,246,.15);
  --r:10px;
}
body{background:var(--bg);color:var(--ink);font-family:'Noto Sans KR',sans-serif;min-height:100vh;padding-bottom:90px}
.hdr{background:var(--surf);border-bottom:1px solid var(--bord);padding:14px 24px;display:flex;align-items:center;gap:14px;position:sticky;top:0;z-index:100}
.hdr-logo{font-family:'Fraunces',serif;font-size:20px;color:var(--acc)}
.hdr-title{font-size:13px;color:var(--ink2)}
.hdr-cnt{margin-left:auto;background:var(--accL);color:var(--acc);font-size:12px;font-weight:700;padding:4px 12px;border-radius:20px;border:1px solid rgba(200,129,90,.3)}
.wrap{max-width:1200px;margin:0 auto;padding:24px 20px}
.card{background:var(--surf);border:1px solid var(--bord);border-radius:14px;padding:20px;margin-bottom:16px}
.card-title{font-size:11px;font-weight:700;color:var(--ink2);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:16px;display:flex;align-items:center;gap:8px}

/* BOOKMARKLET */
.bm-wrap{background:linear-gradient(135deg,rgba(139,124,246,.08),rgba(200,129,90,.08));border:1px solid rgba(139,124,246,.25);border-radius:12px;padding:18px}
.bm-title{font-size:14px;font-weight:700;margin-bottom:8px}
.bm-desc{font-size:12px;color:var(--ink2);line-height:1.8;margin-bottom:14px}
.bm-steps{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}
.bm-step{background:var(--surf2);border:1px solid var(--bord);border-radius:8px;padding:12px;text-align:center}
.bm-num{width:26px;height:26px;background:var(--purpleL);color:var(--purple);border-radius:50%;font-size:12px;font-weight:900;display:flex;align-items:center;justify-content:center;margin:0 auto 8px}
.bm-step-txt{font-size:11px;color:var(--ink2);line-height:1.6}
.bm-step-txt b{color:var(--ink);display:block}
.bm-row{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
.bm-link{padding:12px 22px;background:var(--purple);color:#fff;border-radius:var(--r);font-size:14px;font-weight:700;text-decoration:none;display:inline-block;cursor:grab;border:2px dashed transparent;transition:all .2s;white-space:nowrap}
.bm-link:hover{background:#7A6CE6;border-color:rgba(255,255,255,.4);transform:translateY(-2px)}
.bm-hint{font-size:11px;color:var(--ink3);line-height:1.8}
.bm-hint b{color:var(--ink2)}

/* SETTINGS */
.settings-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.fld{display:flex;flex-direction:column;gap:5px}
.fld-lbl{font-size:11px;font-weight:700;color:var(--ink2)}
input[type=text],input[type=password]{width:100%;background:var(--surf2);border:1.5px solid var(--bord);border-radius:var(--r);color:var(--ink);font-family:'Noto Sans KR',sans-serif;font-size:12px;padding:9px 12px;outline:none;transition:border .15s}
input:focus{border-color:var(--acc)}
input::placeholder{color:var(--ink3)}
.pw-row{display:flex;gap:6px}
.pw-row input{flex:1}
.eye-btn{padding:9px 12px;background:var(--surf2);border:1.5px solid var(--bord);border-radius:var(--r);color:var(--ink2);cursor:pointer;font-size:13px;transition:all .15s}
.eye-btn:hover{border-color:var(--acc)}

/* CAT */
.cat-row{display:flex;gap:7px;flex-wrap:wrap}
.cat-btn{padding:5px 11px;background:var(--surf2);border:1.5px solid var(--bord);border-radius:20px;color:var(--ink2);font-size:11px;cursor:pointer;transition:all .15s;font-family:'Noto Sans KR',sans-serif}
.cat-btn.on{background:var(--accL);border-color:var(--acc);color:var(--acc);font-weight:700}

/* MANUAL INPUT */
textarea{width:100%;background:var(--surf2);border:1.5px solid var(--bord);border-radius:var(--r);color:var(--ink);font-family:'Noto Sans KR',sans-serif;font-size:12px;padding:10px 12px;resize:vertical;outline:none;line-height:1.8}
textarea:focus{border-color:var(--acc)}
textarea::placeholder{color:var(--ink3)}
.manual-grid{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:10px;margin-bottom:12px}

/* BUTTONS */
.btn{padding:10px 18px;border:none;border-radius:var(--r);font-size:13px;font-weight:700;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all .2s;display:inline-flex;align-items:center;gap:6px}
.btn:disabled{opacity:.35;cursor:not-allowed;transform:none!important}
.btn-acc{background:var(--acc);color:#fff}.btn-acc:not(:disabled):hover{background:#B8704A;transform:translateY(-1px)}
.btn-grn{background:var(--grn);color:#fff}.btn-grn:not(:disabled):hover{background:#3A8A5A;transform:translateY(-1px)}
.btn-ghost{background:none;border:1.5px solid var(--bord);color:var(--ink2)}.btn-ghost:not(:disabled):hover{border-color:var(--acc);color:var(--acc)}
.action-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

/* TABLE */
.tbl-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:12px}
th{background:var(--surf2);color:var(--ink2);font-weight:700;padding:10px 8px;text-align:left;border-bottom:2px solid var(--bord);font-size:10px;letter-spacing:.5px;white-space:nowrap}
td{padding:7px 8px;border-bottom:1px solid var(--bord);vertical-align:top}
tr:hover td{background:rgba(255,255,255,.015)}
td input,td select{background:var(--surf2);border:1px solid var(--bord);border-radius:6px;color:var(--ink);font-family:'Noto Sans KR',sans-serif;font-size:11px;padding:4px 7px;outline:none;transition:border .15s;width:100%}
td input:focus,td select:focus{border-color:var(--acc)}

.thumb{width:44px;height:44px;object-fit:cover;border-radius:6px;background:var(--surf2);display:block}
.thumb-ph{width:44px;height:44px;border-radius:6px;background:var(--surf2);display:flex;align-items:center;justify-content:center;font-size:18px;color:var(--ink3)}

/* CHIPS */
.chip-group{display:flex;flex-wrap:wrap;gap:3px}
.chip{font-size:10px;padding:2px 6px;border-radius:4px;cursor:pointer;transition:all .12s;white-space:nowrap;user-select:none;border:1px solid transparent}
.chip-skin{background:var(--accL);color:var(--acc);border-color:rgba(200,129,90,.2)}
.chip-concern{background:var(--grnL);color:var(--grn);border-color:rgba(74,156,106,.2)}
.chip.off{opacity:.2;background:var(--surf2);border-color:var(--bord)}
.chip:hover{opacity:1!important}

.tbl-empty{text-align:center;padding:56px;color:var(--ink3);font-size:14px;line-height:2}

/* BOTTOM */
.bottom{position:fixed;bottom:0;left:0;right:0;background:var(--surf);border-top:1px solid var(--bord);padding:12px 24px;display:flex;align-items:center;gap:10px;z-index:100}
.bottom-cnt{font-size:13px;color:var(--ink2)}
.bottom-cnt b{color:var(--acc);font-size:20px;margin-right:2px}

/* NOTIFY */
.notify{position:fixed;top:70px;right:20px;background:var(--grn);color:#fff;padding:12px 18px;border-radius:10px;font-size:13px;font-weight:700;z-index:999;display:none;box-shadow:0 4px 20px rgba(0,0,0,.3)}

::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--surf)}
::-webkit-scrollbar-thumb{background:var(--bord);border-radius:3px}
</style>
</head>
<body>

<div class="notify" id="notify"></div>

<div class="hdr">
  <div class="hdr-logo">Glowie</div>
  <div class="hdr-title">ì˜¬ë¦¬ë¸Œì˜ ì œí’ˆ ìˆ˜ì§‘ê¸°</div>
  <div class="hdr-cnt" id="hdrCnt">0ê°œ ëŒ€ê¸°ì¤‘</div>
</div>

<div class="wrap">

  <!-- ë¶ë§ˆí¬ë¦¿ -->
  <div class="card">
    <div class="card-title">ğŸ”– ì„¤ì¹˜ ë°©ë²• (1íšŒë§Œ)</div>
    <div class="bm-wrap">
      <div class="bm-title">ì˜¬ë¦¬ë¸Œì˜ í˜ì´ì§€ì—ì„œ í´ë¦­ í•œ ë²ˆìœ¼ë¡œ ìë™ ì¶”ê°€!</div>
      <div class="bm-desc">URL ë³µì‚¬Â·ë¶™ì—¬ë„£ê¸° ì—†ì´, ì˜¬ë¦¬ë¸Œì˜ ì œí’ˆ í˜ì´ì§€ì—ì„œ ë¶ë§ˆí¬ë§Œ í´ë¦­í•˜ë©´ ì œí’ˆëª…Â·ê°€ê²©Â·ë³„ì Â·ë¦¬ë·°Â·ì´ë¯¸ì§€ê°€ ìë™ìœ¼ë¡œ ì—¬ê¸°ì— ì¶”ê°€ë¼ìš”.</div>
      <div class="bm-steps">
        <div class="bm-step"><div class="bm-num">1</div><div class="bm-step-txt"><b>ì•„ë˜ ë³´ë¼ìƒ‰ ë²„íŠ¼</b>ì„ ì¦ê²¨ì°¾ê¸° ë°”ì— ë“œë˜ê·¸ì•¤ë“œë¡­</div></div>
        <div class="bm-step"><div class="bm-num">2</div><div class="bm-step-txt"><b>ì˜¬ë¦¬ë¸Œì˜</b>ì—ì„œ ì›í•˜ëŠ” ì œí’ˆ í˜ì´ì§€ ì—´ê¸°</div></div>
        <div class="bm-step"><div class="bm-num">3</div><div class="bm-step-txt">ì¦ê²¨ì°¾ê¸°ì— ì €ì¥í•œ <b>Glowie ì¶”ê°€</b> í´ë¦­</div></div>
        <div class="bm-step"><div class="bm-num">4</div><div class="bm-step-txt">ì´ ë„êµ¬ë¡œ ëŒì•„ì˜¤ë©´ <b>ì œí’ˆì´ ìë™ìœ¼ë¡œ</b> ì¶”ê°€ë¼ ìˆì–´ìš”!</div></div>
      </div>
      <div class="bm-row">
        <a id="bmLink" class="bm-link" href="#">â­ Glowieì— ì¶”ê°€</a>
        <div class="bm-hint">
          <b>ğŸ‘† ì´ ë²„íŠ¼ì„ ë¸Œë¼ìš°ì € ì¦ê²¨ì°¾ê¸° ë°”ì— ë“œë˜ê·¸í•˜ì„¸ìš”</b><br>
          ì¦ê²¨ì°¾ê¸° ë°” ì•ˆ ë³´ì´ë©´: Chrome â†’ Ctrl+Shift+B (Mac: Cmd+Shift+B)<br>
          ëª¨ë°”ì¼ì€ ì§€ì› ì•ˆ ë¼ìš”. PC í¬ë¡¬/ì—£ì§€ì—ì„œ ì‚¬ìš©í•˜ì„¸ìš”.
        </div>
      </div>
    </div>
  </div>

  <!-- Supabase ì„¤ì • -->
  <div class="card">
    <div class="card-title">âš™ï¸ Supabase ì—°ê²°</div>
    <div class="settings-row">
      <div class="fld">
        <div class="fld-lbl">Supabase URL</div>
        <input type="text" id="sbUrl" value="https://hwajzlehsfqrgpywjgit.supabase.co"/>
      </div>
      <div class="fld">
        <div class="fld-lbl">Anon Key</div>
        <div class="pw-row">
          <input type="password" id="sbKey" value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3YWp6bGVoc2ZxcmdweXdqZ2l0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMjU2MzcsImV4cCI6MjA4NzcwMTYzN30.B1fw50cLpZeTH9yxWZZkl1k-rq82XsiLUN6n_g7Dkuk"/>
          <button class="eye-btn" onclick="toggleKey()">ğŸ‘</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì§ì ‘ ì…ë ¥ -->
  <div class="card">
    <div class="card-title">âœï¸ ì§ì ‘ ì…ë ¥</div>
    <div class="fld" style="margin-bottom:12px">
      <div class="fld-lbl" style="margin-bottom:7px">ì¹´í…Œê³ ë¦¬</div>
      <div class="cat-row" id="catRow"></div>
    </div>
    <div class="manual-grid">
      <div class="fld">
        <div class="fld-lbl">ì œí’ˆëª… * (í•œ ì¤„ì— í•˜ë‚˜)</div>
        <textarea id="taNames" rows="5" placeholder="ë¼ìš´ë“œë© 1025 ë…ë„ í† ë„ˆ&#10;ì½”ìŠ¤ì•Œì—‘ìŠ¤ ì–´ë“œë°´ì‹œì¹´ ì‹œì¹´ ì„¸ëŸ¼&#10;í† ë¦¬ë“  ë‹¤ì´ë¸Œì¸ íˆì•Œë£¨ë¡ ì‚° ì„¸ëŸ¼"></textarea>
      </div>
      <div class="fld">
        <div class="fld-lbl">ê°€ê²© (ì›)</div>
        <textarea id="taPrices" rows="5" placeholder="16000&#10;21000&#10;19000"></textarea>
      </div>
      <div class="fld">
        <div class="fld-lbl">ë³„ì </div>
        <textarea id="taRatings" rows="5" placeholder="4.8&#10;4.8&#10;4.9"></textarea>
      </div>
      <div class="fld">
        <div class="fld-lbl">ë¦¬ë·°ìˆ˜</div>
        <textarea id="taReviews" rows="5" placeholder="29000&#10;31000&#10;22000"></textarea>
      </div>
    </div>
    <div class="action-row">
      <button class="btn btn-acc" onclick="manualAdd()">ğŸ¤– AI ë¶„ì„ í›„ ì¶”ê°€</button>
      <span style="font-size:11px;color:var(--ink3)">ì œí’ˆëª…ë§Œ ìˆì–´ë„ ì„±ë¶„Â·í”¼ë¶€íƒ€ì…Â·í”¼ë¶€ê³ ë¯¼ ìë™ ì™„ì„±!</span>
    </div>
  </div>

  <!-- ê²°ê³¼ í…Œì´ë¸” -->
  <div class="card">
    <div class="card-title">
      ğŸ“Š ìˆ˜ì§‘ëœ ì œí’ˆ
      <span id="tblCnt" style="font-size:11px;color:var(--ink3);font-weight:400;text-transform:none;letter-spacing:0;margin-left:4px"></span>
    </div>
    <div class="tbl-wrap">
      <table>
        <thead>
          <tr>
            <th>ì´ë¯¸ì§€</th>
            <th style="min-width:160px">ì œí’ˆëª…</th>
            <th style="width:80px">ë¸Œëœë“œ</th>
            <th style="width:90px">ì¹´í…Œê³ ë¦¬</th>
            <th style="min-width:200px">ì£¼ìš” ì„±ë¶„</th>
            <th style="min-width:160px">í”¼ë¶€íƒ€ì… (í´ë¦­ í† ê¸€)</th>
            <th style="min-width:220px">í”¼ë¶€ ê³ ë¯¼ (í´ë¦­ í† ê¸€)</th>
            <th style="width:65px">ê°€ê²©</th>
            <th style="width:50px">ë³„ì </th>
            <th style="width:65px">ë¦¬ë·°ìˆ˜</th>
            <th style="min-width:110px">ì˜¬ë¦¬ë¸Œì˜ ë§í¬</th>
            <th style="width:50px">ì‚­ì œ</th>
          </tr>
        </thead>
        <tbody id="tblBody">
          <tr><td colspan="12" class="tbl-empty">ğŸ”– ë¶ë§ˆí¬ë¦¿ìœ¼ë¡œ ì˜¬ë¦¬ë¸Œì˜ ì œí’ˆì„ ì¶”ê°€í•˜ê±°ë‚˜<br>ì§ì ‘ ì…ë ¥ìœ¼ë¡œ ì œí’ˆì„ ì¶”ê°€í•´ë³´ì„¸ìš”</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<div class="bottom">
  <div class="bottom-cnt"><b id="bottomCnt">0</b> ê°œ ìˆ˜ì§‘ë¨</div>
  <button class="btn btn-grn" id="btnSave" onclick="saveToSupabase()" disabled>â˜ï¸ Supabase ì €ì¥</button>
  <button class="btn btn-ghost" id="btnCsv" onclick="exportCSV()" disabled>â¬‡ï¸ CSV ë‹¤ìš´ë¡œë“œ</button>
  <button class="btn btn-ghost" onclick="clearAll()" style="margin-left:auto">ğŸ—‘ ì „ì²´ ì´ˆê¸°í™”</button>
</div>

<script>
const CATEGORIES=[
  {id:"toner",label:"ìŠ¤í‚¨/í† ë„ˆ"},{id:"essence",label:"ì„¸ëŸ¼/ì•°í”Œ"},
  {id:"cream",label:"í¬ë¦¼"},{id:"lotion",label:"ë¡œì…˜/ì˜¤ì¼"},
  {id:"cleansing",label:"í´ë Œì§•í¼"},{id:"cleansing_oil",label:"í´ë Œì§•ì˜¤ì¼"},
  {id:"peeling",label:"í•„ë§"},{id:"sunscreen",label:"ì„ ì¼€ì–´"},
  {id:"mask",label:"ë§ˆìŠ¤í¬íŒ©"},{id:"body",label:"ë°”ë””ì¼€ì–´"},
];
const SKIN_TYPES=["ì§€ì„±","ê±´ì„±","ë³µí•©ì„±","ë¯¼ê°ì„±"];
const CONCERNS=["ì—¬ë“œë¦„","ì—¬ë“œë¦„í”ì ","ë¶‰ì€ìêµ­","ëª¨ê³µ","ë¸”ë™í—¤ë“œ","ìˆ˜ë¶„ë¶€ì¡±","ì¹™ì¹™í•¨","ë¯¼ê°","ë“±ë“œë¦„"];

let selectedCat="essence";
let rows=[];

function renderCats(){
  document.getElementById("catRow").innerHTML=CATEGORIES.map(c=>
    `<button class="cat-btn${selectedCat===c.id?" on":""}" onclick="selCat('${c.id}')">${c.label}</button>`
  ).join("");
}
function selCat(id){selectedCat=id;renderCats();}
renderCats();
function toggleKey(){const e=document.getElementById("sbKey");e.type=e.type==="password"?"text":"password";}

// â”€â”€ ì„±ë¶„ + í”¼ë¶€íƒ€ì… + í”¼ë¶€ê³ ë¯¼ í†µí•© DB â”€â”€
const BRAND_DB={
  "ë¼ìš´ë“œë©":["ë¼ìš´ë“œë©","round lab"],"ì½”ìŠ¤ì•Œì—‘ìŠ¤":["ì½”ìŠ¤ì•Œì—‘ìŠ¤","cosrx"],
  "ì´ë‹ˆìŠ¤í”„ë¦¬":["ì´ë‹ˆìŠ¤í”„ë¦¬","innisfree"],"í† ë¦¬ë“ ":["í† ë¦¬ë“ ","torriden"],
  "ë§ˆë…€ê³µì¥":["ë§ˆë…€ê³µì¥","manyo"],"ë‹¥í„°ì§€":["ë‹¥í„°ì§€","dr.g"],
  "ë‹¥í„°ìë¥´íŠ¸":["ë‹¥í„°ìë¥´íŠ¸","dr.jart"],"ë©”ë””í":["ë©”ë””í","mediheal"],
  "ë¯¸ìƒ¤":["ë¯¸ìƒ¤","missha"],"ì•„ë²¤ëŠ":["ì•„ë²¤ëŠ","avene"],"ë¹„ì˜¤ì—˜":["ë¹„ì˜¤ì—˜","biol"],
  "ìŠ¤í‚¨1004":["ìŠ¤í‚¨1004","skin1004"],"ë„˜ë²„ì¦ˆì¸":["ë„˜ë²„ì¦ˆì¸","numbuzin"],
  "í‹°ë¥´í‹°ë¥´":["í‹°ë¥´í‹°ë¥´","tirtir"],"ì¡°ì„ ë¯¸ë…€":["ì¡°ì„ ë¯¸ë…€","beauty of joseon"],
  "VT":["vtì½”ìŠ¤ë©”í‹±","vtì½”"],"í”¼ì§€ì˜¤ê²”":["í”¼ì§€ì˜¤ê²”","physiogel"],
  "ì„¸íƒ€í•„":["ì„¸íƒ€í•„","cetaphil"],"CNP":["cnp","ì”¨ì—”í”¼"],
  "íŒŒìš¸ë¼ìŠ¤ì´ˆì´ìŠ¤":["íŒŒìš¸ë¼ìŠ¤ì´ˆì´ìŠ¤","paula"],"ì œì´ì¤€":["ì œì´ì¤€","jayjun"],
  "ì•„ì´ì†Œì´":["ì•„ì´ì†Œì´","isoi"],"í—‰ìŠ¬ë¦¬":["í—‰ìŠ¬ë¦¬","huxley"],
  "ë¼ë¡œìŠˆí¬ì œ":["ë¼ë¡œìŠˆí¬ì œ","la roche"],"ì„¤í™”ìˆ˜":["ì„¤í™”ìˆ˜"],
  "í´ë¦¬ì˜¤":["í´ë¦¬ì˜¤","clio"],"ë°”ì´ì˜¤ë”ë§ˆ":["ë°”ì´ì˜¤ë”ë§ˆ","bioderma"],
};
// í‚¤ì›Œë“œ â†’ { ì„±ë¶„, í”¼ë¶€íƒ€ì…, í”¼ë¶€ê³ ë¯¼, íƒœê·¸ }
const INGR_DB=[
  {k:"ë…ë„",       i:"ë…ë„ í•´ì–‘ì‹¬ì¸µìˆ˜, íˆì•Œë£¨ë¡ ì‚°, íŒí…Œë†€",           st:["ê±´ì„±","ë³µí•©ì„±","ë¯¼ê°ì„±"], cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¶‰ì€ìêµ­","ë¯¼ê°"],           tg:["ìˆ˜ë¶„","ì§„ì •"]},
  {k:"ìì‘ë‚˜ë¬´",   i:"ìì‘ë‚˜ë¬´ ìˆ˜ì•¡, íˆì•Œë£¨ë¡ ì‚°, íŒí…Œë†€",             st:["ê±´ì„±","ë³µí•©ì„±","ë¯¼ê°ì„±"], cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¯¼ê°"],                      tg:["ìˆ˜ë¶„","ì €ìê·¹"]},
  {k:"ì–´ë“œë°´ì‹œì¹´", i:"ì„¼í…”ë¼ì•„ì‹œì•„í‹°ì¹´, ë§ˆë°ì¹´ì†Œì‚¬ì´ë“œ, íŒí…Œë†€",       st:["ì§€ì„±","ë³µí•©ì„±","ë¯¼ê°ì„±"], cn:["ì—¬ë“œë¦„","ë¶‰ì€ìêµ­","ì—¬ë“œë¦„í”ì ","ë¯¼ê°"], tg:["ì§„ì •","ì‹œì¹´"]},
  {k:"ì‹œì¹´í˜ì–´",   i:"ì„¼í…”ë¼ì•„ì‹œì•„í‹°ì¹´, íŒí…Œë†€, ë§ˆë°ì¹´ì†Œì‚¬ì´ë“œ",       st:["ë¯¼ê°ì„±","ê±´ì„±"],          cn:["ì—¬ë“œë¦„","ë¶‰ì€ìêµ­","ë¯¼ê°"],             tg:["ì‹œì¹´","ì¥ë²½ê°•í™”"]},
  {k:"ì‹œì¹´",       i:"ì„¼í…”ë¼ì•„ì‹œì•„í‹°ì¹´, ë§ˆë°ì¹´ì†Œì‚¬ì´ë“œ, íŒí…Œë†€",       st:["ë¯¼ê°ì„±","ì§€ì„±","ë³µí•©ì„±"], cn:["ì—¬ë“œë¦„","ë¶‰ì€ìêµ­","ì—¬ë“œë¦„í”ì "],        tg:["ì§„ì •","ì‹œì¹´"]},
  {k:"ì„¼í…”ë¼",     i:"ì„¼í…”ë¼ì•„ì‹œì•„í‹°ì¹´, ë§ˆë°ì¹´ì†Œì‚¬ì´ë“œ, íŒí…Œë†€",       st:["ë¯¼ê°ì„±","ì§€ì„±","ë³µí•©ì„±"], cn:["ì—¬ë“œë¦„","ë¶‰ì€ìêµ­"],                    tg:["ì§„ì •","ì‹œì¹´"]},
  {k:"ë‹¤ì´ë¸Œì¸",   i:"ì €ë¶„ì íˆì•Œë£¨ë¡ ì‚° 5ì¢…, íŒí…Œë†€, ì„¸ë¼ë§ˆì´ë“œ",      st:["ê±´ì„±","ë³µí•©ì„±","ë¯¼ê°ì„±"], cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¯¼ê°"],                      tg:["ìˆ˜ë¶„í­íƒ„","ë³´ìŠµ"]},
  {k:"íˆì•Œë£¨ë¡ ì‚°", i:"ì €ë¶„ì íˆì•Œë£¨ë¡ ì‚° 5ì¢…, íŒí…Œë†€, ë² íƒ€ì¸",          st:["ê±´ì„±","ë³µí•©ì„±","ë¯¼ê°ì„±"], cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¯¼ê°"],                      tg:["ìˆ˜ë¶„","ë³´ìŠµ"]},
  {k:"NMF",        i:"NMF, íˆì•Œë£¨ë¡ ì‚°, ì•„ë¯¸ë…¸ì‚°",                      st:["ê±´ì„±","ë³µí•©ì„±","ë¯¼ê°ì„±"], cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¯¼ê°"],                      tg:["ìˆ˜ë¶„í­íƒ„","ë³´ìŠµ"]},
  {k:"ì„¸ë¼ë§ˆì´ë“œ", i:"ì„¸ë¼ë§ˆì´ë“œ, íˆì•Œë£¨ë¡ ì‚°, íŒí…Œë†€",                 st:["ê±´ì„±","ë¯¼ê°ì„±"],          cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¯¼ê°"],                      tg:["ì¥ë²½ê°•í™”","ë³´ìŠµ"]},
  {k:"ë¹„í”¼ë‹¤",     i:"ë¹„í”¼ë‹¤ ë°œíš¨ì—¬ê³¼ë¬¼, íŒí…Œë†€, ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ",    st:["ê±´ì„±","ë¯¼ê°ì„±","ë³µí•©ì„±"], cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¶‰ì€ìêµ­","ë¯¼ê°"],            tg:["ì¥ë²½ê°•í™”","ì§„ì •"]},
  {k:"ê°ˆë½í† ë¯¸ì„¸ìŠ¤",i:"ê°ˆë½í† ë¯¸ì„¸ìŠ¤ ë°œíš¨ì—¬ê³¼ë¬¼, ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ",     st:["ì§€ì„±","ë³µí•©ì„±"],          cn:["ì¹™ì¹™í•¨","ì—¬ë“œë¦„í”ì ","ëª¨ê³µ"],           tg:["ë¯¸ë°±","ê´‘ì±„"]},
  {k:"ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ",i:"ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ, ì•„ì—°, íŒí…Œë†€",            st:["ì§€ì„±","ë³µí•©ì„±"],          cn:["ì—¬ë“œë¦„í”ì ","ì¹™ì¹™í•¨","ëª¨ê³µ"],           tg:["ë¯¸ë°±","ëª¨ê³µ"]},
  {k:"ë¹„íƒ€ë¯¼C",    i:"ë¹„íƒ€ë¯¼C, ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ, ê¸€ë¦¬ì„¸ë¦°",            st:["ì§€ì„±","ë³µí•©ì„±","ê±´ì„±"],   cn:["ì¹™ì¹™í•¨","ì—¬ë“œë¦„í”ì "],                  tg:["ë¯¸ë°±","í•­ì‚°í™”"]},
  {k:"AHA",        i:"AHA, ê¸€ë¦¬ì½œì‚°, íŒí…Œë†€",                          st:["ì§€ì„±","ë³µí•©ì„±"],          cn:["ëª¨ê³µ","ë¸”ë™í—¤ë“œ","ì—¬ë“œë¦„í”ì ","ì¹™ì¹™í•¨"],tg:["ê°ì§ˆ","ëª¨ê³µ"]},
  {k:"BHA",        i:"BHA, ì‚´ë¦¬ì‹¤ì‚°, íŒí…Œë†€",                          st:["ì§€ì„±","ë³µí•©ì„±"],          cn:["ëª¨ê³µ","ì—¬ë“œë¦„","ë¸”ë™í—¤ë“œ"],             tg:["ê°ì§ˆ","ëª¨ê³µ"]},
  {k:"ì‚´ë¦¬ì‹¤ì‚°",   i:"ì‚´ë¦¬ì‹¤ì‚°, íŒí…Œë†€, ì•Œë¡œì—ë² ë¼",                   st:["ì§€ì„±","ë³µí•©ì„±"],          cn:["ì—¬ë“œë¦„","ëª¨ê³µ","ë“±ë“œë¦„"],               tg:["ì—¬ë“œë¦„ì¼€ì–´","í”¼ì§€"]},
  {k:"í™”ì‚°ì†¡ì´",   i:"í™”ì‚°ì†¡ì´ ë¶„ë§, ì¹´ì˜¬ë¦°, ë…¹ì°¨",                    st:["ì§€ì„±"],                   cn:["ëª¨ê³µ","ë¸”ë™í—¤ë“œ"],                      tg:["ëª¨ê³µ","í”¼ì§€í¡ìˆ˜"]},
  {k:"ë ˆí‹°ë†€",     i:"ë ˆí‹°ë†€, íˆì•Œë£¨ë¡ ì‚°, ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ",           st:["ê±´ì„±","ë³µí•©ì„±"],          cn:["ì¹™ì¹™í•¨","ìˆ˜ë¶„ë¶€ì¡±"],                    tg:["ì•ˆí‹°ì—ì´ì§•","íƒ„ë ¥"]},
  {k:"í©íƒ€ì´ë“œ",   i:"í©íƒ€ì´ë“œ, íˆì•Œë£¨ë¡ ì‚°, ì„¸ë¼ë§ˆì´ë“œ",               st:["ê±´ì„±","ë³µí•©ì„±"],          cn:["ìˆ˜ë¶„ë¶€ì¡±","ì¹™ì¹™í•¨"],                    tg:["íƒ„ë ¥","ì•ˆí‹°ì—ì´ì§•"]},
  {k:"í”„ë¡œí´ë¦¬ìŠ¤", i:"í”„ë¡œí´ë¦¬ìŠ¤, ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ, íˆì•Œë£¨ë¡ ì‚°",       st:["ê±´ì„±","ë³µí•©ì„±"],          cn:["ìˆ˜ë¶„ë¶€ì¡±","ì¹™ì¹™í•¨"],                    tg:["ì˜ì–‘","ë³´ìŠµ"]},
  {k:"í‹°íŠ¸ë¦¬",     i:"í‹°íŠ¸ë¦¬, ì‚´ë¦¬ì‹¤ì‚°, ì•Œë¡œì—ë² ë¼",                   st:["ì§€ì„±","ë³µí•©ì„±"],          cn:["ì—¬ë“œë¦„","ëª¨ê³µ","ë“±ë“œë¦„"],               tg:["ì—¬ë“œë¦„ì¼€ì–´","í”¼ì§€"]},
  {k:"ë…¹ì°¨",       i:"ë…¹ì°¨ ì¶”ì¶œë¬¼, íˆì•Œë£¨ë¡ ì‚°, ê¸€ë¦¬ì„¸ë¦°",              st:["ì§€ì„±","ë³µí•©ì„±"],          cn:["ëª¨ê³µ","ì¹™ì¹™í•¨"],                        tg:["í•­ì‚°í™”","ìˆ˜ë¶„"]},
  {k:"SPF",        i:"ìì™¸ì„ ì°¨ë‹¨ ì„±ë¶„, íˆì•Œë£¨ë¡ ì‚°, íŒí…Œë†€",             st:["ê±´ì„±","ë³µí•©ì„±","ë¯¼ê°ì„±"], cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¶‰ì€ìêµ­"],                  tg:["ìì™¸ì„ ì°¨ë‹¨","ìˆ˜ë¶„"]},
  {k:"ì„ í¬ë¦¼",     i:"ì§•í¬ì˜¥ì‚¬ì´ë“œ, í‹°íƒ€ëŠ„ë‹¤ì´ì˜¥ì‚¬ì´ë“œ, íŒí…Œë†€",       st:["ë¯¼ê°ì„±","ê±´ì„±","ë³µí•©ì„±"], cn:["ë¯¼ê°","ë¶‰ì€ìêµ­"],                      tg:["ìì™¸ì„ ì°¨ë‹¨","ìˆœí•œ"]},
  {k:"ì½œë¼ê²",     i:"ê°€ìˆ˜ë¶„í•´ ì½œë¼ê², íˆì•Œë£¨ë¡ ì‚°, ê¸€ë¦¬ì„¸ë¦°",          st:["ê±´ì„±","ë³µí•©ì„±"],          cn:["ìˆ˜ë¶„ë¶€ì¡±","ì¹™ì¹™í•¨"],                    tg:["íƒ„ë ¥","ë³´ìŠµ"]},
  {k:"ë¡œì¦ˆ",       i:"ë¡œì¦ˆì›Œí„°, íˆì•Œë£¨ë¡ ì‚°, ê¸€ë¦¬ì„¸ë¦°",                 st:["ê±´ì„±","ë¯¼ê°ì„±"],          cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¶‰ì€ìêµ­"],                  tg:["ìˆ˜ë¶„","ì§„ì •"]},
  {k:"ìŠ¤ì¿ ì•Œë€",   i:"ìŠ¤ì¿ ì•Œë€, íˆì•Œë£¨ë¡ ì‚°, ì„¸ë¼ë§ˆì´ë“œ",               st:["ê±´ì„±","ë¯¼ê°ì„±"],          cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¯¼ê°"],                      tg:["ë³´ìŠµ","ì¥ë²½ê°•í™”"]},
  {k:"ë°”ì¿ ì¹˜ì˜¬",   i:"ë°”ì¿ ì¹˜ì˜¬, íˆì•Œë£¨ë¡ ì‚°, ìŠ¤ì¿ ì•Œë€",                 st:["ë¯¼ê°ì„±","ê±´ì„±"],          cn:["ì¹™ì¹™í•¨","ìˆ˜ë¶„ë¶€ì¡±"],                    tg:["ìˆœí•œì•ˆí‹°ì—ì´ì§•","íƒ„ë ¥"]},
  {k:"ì•„ì ¤ë¼ìµ",   i:"ì•„ì ¤ë¼ìµì• ì”¨ë“œ, ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ, íŒí…Œë†€",       st:["ì§€ì„±","ë³µí•©ì„±"],          cn:["ì—¬ë“œë¦„","ì—¬ë“œë¦„í”ì ","ì¹™ì¹™í•¨"],          tg:["ì—¬ë“œë¦„ì¼€ì–´","ë¯¸ë°±"]},
];
const CAT_DEF={
  toner:       {i:"íˆì•Œë£¨ë¡ ì‚°, ê¸€ë¦¬ì„¸ë¦°, íŒí…Œë†€",        st:["ê±´ì„±","ë³µí•©ì„±"],          cn:["ìˆ˜ë¶„ë¶€ì¡±"],           tg:["ìˆ˜ë¶„","ë³´ìŠµ"]},
  essence:     {i:"íˆì•Œë£¨ë¡ ì‚°, ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ, íŒí…Œë†€", st:["ê±´ì„±","ë³µí•©ì„±"],          cn:["ìˆ˜ë¶„ë¶€ì¡±","ì¹™ì¹™í•¨"],   tg:["ì˜ì–‘","ë³´ìŠµ"]},
  cream:       {i:"ì„¸ë¼ë§ˆì´ë“œ, íˆì•Œë£¨ë¡ ì‚°, ê¸€ë¦¬ì„¸ë¦°",     st:["ê±´ì„±","ë³µí•©ì„±"],          cn:["ìˆ˜ë¶„ë¶€ì¡±"],           tg:["ë³´ìŠµ","ìˆ˜ë¶„"]},
  lotion:      {i:"íˆì•Œë£¨ë¡ ì‚°, ê¸€ë¦¬ì„¸ë¦°, ì•Œë¡œì—ë² ë¼",     st:["ê±´ì„±","ë³µí•©ì„±"],          cn:["ìˆ˜ë¶„ë¶€ì¡±"],           tg:["ìˆ˜ë¶„","ê°€ë²¼ìš´"]},
  cleansing:   {i:"íŒí…Œë†€, ê¸€ë¦¬ì„¸ë¦°, ì•Œë¡œì—ë² ë¼",         st:["ê±´ì„±","ë³µí•©ì„±","ë¯¼ê°ì„±"], cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¯¼ê°"],     tg:["ì €ìê·¹","ìˆœí•œ"]},
  cleansing_oil:{i:"í˜¸í˜¸ë°”ì˜¤ì¼, í¬ë„ì”¨ì˜¤ì¼, íŒí…Œë†€",      st:["ì§€ì„±","ë³µí•©ì„±"],          cn:["ëª¨ê³µ","ë¸”ë™í—¤ë“œ"],     tg:["ë”¥í´ë Œì§•","ì˜¤ì¼í´ë Œì§•"]},
  peeling:     {i:"AHA, BHA, íŒí…Œë†€",                    st:["ì§€ì„±","ë³µí•©ì„±"],          cn:["ëª¨ê³µ","ë¸”ë™í—¤ë“œ","ì¹™ì¹™í•¨"],tg:["ê°ì§ˆ","ëª¨ê³µ"]},
  sunscreen:   {i:"ìì™¸ì„ ì°¨ë‹¨ ì„±ë¶„, íˆì•Œë£¨ë¡ ì‚°, íŒí…Œë†€",  st:["ê±´ì„±","ë³µí•©ì„±","ë¯¼ê°ì„±"], cn:["ìˆ˜ë¶„ë¶€ì¡±","ë¯¼ê°"],     tg:["ìì™¸ì„ ì°¨ë‹¨","ìˆ˜ë¶„"]},
  mask:        {i:"íˆì•Œë£¨ë¡ ì‚°, íŒí…Œë†€, ê¸€ë¦¬ì„¸ë¦°",         st:["ê±´ì„±","ë³µí•©ì„±","ë¯¼ê°ì„±"], cn:["ìˆ˜ë¶„ë¶€ì¡±"],           tg:["ìˆ˜ë¶„í­íƒ„","ì§„ì •"]},
  body:        {i:"ì„¸ë¼ë§ˆì´ë“œ, ì‹œì–´ë²„í„°, ê¸€ë¦¬ì„¸ë¦°",        st:["ê±´ì„±","ë³µí•©ì„±"],          cn:["ìˆ˜ë¶„ë¶€ì¡±","ë“±ë“œë¦„"],   tg:["ë³´ìŠµ","ë°”ë””"]},
};

function analyze(name,cat){
  const lower=name.toLowerCase();
  let brand="";
  for(const [b,kws] of Object.entries(BRAND_DB)){
    if(kws.some(k=>lower.includes(k.toLowerCase()))){brand=b;break;}
  }
  let matched=null;
  for(const d of INGR_DB){
    if(name.includes(d.k)||lower.includes(d.k.toLowerCase())){matched=d;break;}
  }
  const def=CAT_DEF[cat]||CAT_DEF.essence;
  return{brand,ingredient:matched?.i||def.i,skin_types:[...(matched?.st||def.st)],concerns:[...(matched?.cn||def.cn)],tags:[...(matched?.tg||def.tg)]};
}

// â”€â”€ ë¶ë§ˆí¬ë¦¿ ìƒì„± â”€â”€
function makeBM(){
  const toolUrl=window.location.href.split('?')[0];
  const script=`(function(){
/* ì˜¬ë¦¬ë¸Œì˜ ì‹¤ì œ DOM êµ¬ì¡° ê¸°ë°˜ ì…€ë ‰í„° */
/* ì œí’ˆëª… */
var name='';
var nEls=[document.querySelector('h2.prd-name'),document.querySelector('.prd-name'),document.querySelector('.goods-name'),document.querySelector('h2')];
for(var i=0;i<nEls.length;i++){if(nEls[i]&&nEls[i].innerText.trim().length>2){name=nEls[i].innerText.trim().split('\n')[0].trim();break;}}
if(!name){name=document.title.replace(/\\s*[:\\|].*/,'').replace(/\\s*-\\s*ì˜¬ë¦¬ë¸Œì˜.*/,'').trim();}

/* ê°€ê²© - ì˜¬ë¦¬ë¸Œì˜ì€ í• ì¸ê°€ë¥¼ .price-2 em ì— í‘œì‹œ */
var price='';
var pEls=['.price-2 em','.price-2 strong','.price em','.sale-price em','[class*="price2"] em','[class*="salePrice"]','.final-price'];
for(var i=0;i<pEls.length;i++){var el=document.querySelector(pEls[i]);if(el){var v=el.innerText.replace(/[^0-9]/g,'');if(v.length>=3){price=v;break;}}}
/* ëª» ì°¾ìœ¼ë©´ í˜ì´ì§€ì—ì„œ ì› ë‹¨ìœ„ ìˆ«ì ì§ì ‘ íƒìƒ‰ */
if(!price){var all=document.querySelectorAll('strong,em,b,span');for(var i=0;i<all.length;i++){var t=all[i].innerText.trim();if(/^[0-9]{4,6},?[0-9]{0,3}ì›$/.test(t)){price=t.replace(/[^0-9]/g,'');break;}}}

/* ë³„ì  - .rvw-grade, .grade-star, data-score ë“± */
var rating='4.5';
var rSelectors=['.rvw-grade em','.rvw-point','.grade em','[class*="avgScore"]','[class*="rvwGrade"]','[class*="starScore"]'];
for(var i=0;i<rSelectors.length;i++){var el=document.querySelector(rSelectors[i]);if(el){var m=el.innerText.match(/[0-9]+\.[0-9]+/);if(m){rating=m[0];break;}}}

/* ë¦¬ë·°ìˆ˜ - .rvw-num em, ë¦¬ë·° Nê±´ íŒ¨í„´ */
var reviews='0';
var rvSelectors=['.rvw-num em','.rvw-num','.review-num','[class*="rvwNum"]','[class*="reviewCnt"]','[class*="rvwCnt"]'];
for(var i=0;i<rvSelectors.length;i++){var el=document.querySelector(rvSelectors[i]);if(el){var v=el.innerText.replace(/[^0-9]/g,'');if(v){reviews=v;break;}}}
/* ëª» ì°¾ìœ¼ë©´ "Nê±´" íŒ¨í„´ í…ìŠ¤íŠ¸ íƒìƒ‰ */
if(reviews==='0'){var all=document.querySelectorAll('span,em,a');for(var i=0;i<all.length;i++){var t=all[i].innerText.trim();if(/^[0-9,]+ê±´$/.test(t)){reviews=t.replace(/[^0-9]/g,'');break;}}}

/* ì´ë¯¸ì§€ */
var image='';
var imgEls=['.prd-img img','.goods-img img','.product-img img','[class*="prdImg"] img','[class*="goodsImg"] img','.zoom img'];
for(var i=0;i<imgEls.length;i++){var el=document.querySelector(imgEls[i]);if(el&&el.src&&el.src.startsWith('http')){image=el.src;break;}}

if(!name||name.length<2){alert('ì œí’ˆëª…ì„ ì°¾ì§€ ëª»í–ˆì–´ìš”!\nì˜¬ë¦¬ë¸Œì˜ ì œí’ˆ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');return;}

var data={name:name,price:price,rating:rating,reviews:reviews,image:image,url:window.location.href};

/* confirm ì—†ì´ ë°”ë¡œ ì´ë™ + í˜„ì¬ì°½ ì´ë™ (ìƒˆì°½X) */
alert('âœ… ìˆ˜ì§‘ë¨!\nì œí’ˆëª…: '+name+'\nê°€ê²©: '+(price?price+'ì›':'ë¯¸í™•ì¸')+'\në³„ì : '+rating+' / ë¦¬ë·°: '+reviews+'ê±´\n\nìˆ˜ì§‘ ë„êµ¬ë¡œ ì´ë™í•©ë‹ˆë‹¤!');
location.href='${toolUrl}?add='+encodeURIComponent(JSON.stringify(data));
})();`.replace(/\n/g,' ');
  document.getElementById("bmLink").href="javascript:"+encodeURIComponent(script);
}
makeBM();

// URL íŒŒë¼ë¯¸í„°ë¡œ ë°ì´í„° ìˆ˜ì‹ 
(function(){
  const p=new URLSearchParams(window.location.search);
  const d=p.get("add");
  if(d){
    try{
      const data=JSON.parse(decodeURIComponent(d));
      window.history.replaceState({},"",window.location.pathname);
      setTimeout(()=>addRow(data), 300);
    }catch(e){ console.error("íŒŒì‹± ì˜¤ë¥˜",e); }
  }
})();

// BroadcastChannel â€” ê°™ì€ ë¸Œë¼ìš°ì € íƒ­ë¼ë¦¬ í†µì‹ 
(function(){
  try {
    const bc = new BroadcastChannel('glowie_channel');
    bc.onmessage = (e) => {
      if(e.data?.type === 'ADD_PRODUCT') {
        addRow(e.data.data);
        showNotify('âœ… "' + e.data.data.name.slice(0,15) + '" ì¶”ê°€ë¨!');
      }
    };
  } catch(e) { console.log('BroadcastChannel ë¯¸ì§€ì›'); }
})();


function addRow(data){
  const analysis=analyze(data.name,selectedCat);
  rows.unshift({
    id:Date.now()+Math.random(),
    name:data.name,brand:analysis.brand,category:selectedCat,
    ingredient:analysis.ingredient,
    skin_types:[...analysis.skin_types],concerns:[...analysis.concerns],tags:[...analysis.tags],
    price:data.price||"",rating:data.rating||"4.5",reviews:data.reviews||"0",
    image:data.image||"",oliveyoung:data.url||"",
  });
  renderTable();updateCount();
  showNotify(`âœ… "${data.name.slice(0,20)}" ì¶”ê°€ë¨!`);
}

// â”€â”€ ì§ì ‘ ì…ë ¥ â”€â”€
function manualAdd(){
  const names=document.getElementById("taNames").value.trim().split("\n").map(s=>s.trim()).filter(Boolean);
  if(!names.length){alert("ì œí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");return;}
  const prices=document.getElementById("taPrices").value.trim().split("\n");
  const ratings=document.getElementById("taRatings").value.trim().split("\n");
  const reviews=document.getElementById("taReviews").value.trim().split("\n");
  names.forEach((name,i)=>{
    const a=analyze(name,selectedCat);
    rows.push({
      id:Date.now()+i+Math.random(),name,brand:a.brand,category:selectedCat,
      ingredient:a.ingredient,skin_types:[...a.skin_types],concerns:[...a.concerns],tags:[...a.tags],
      price:(prices[i]||"").replace(/[^0-9]/g,""),
      rating:(ratings[i]||"4.5").trim(),
      reviews:(reviews[i]||"0").replace(/[^0-9]/g,""),
      image:"",oliveyoung:"",
    });
  });
  renderTable();updateCount();
  ["taNames","taPrices","taRatings","taReviews"].forEach(id=>document.getElementById(id).value="");
  showNotify(`âœ… ${names.length}ê°œ ì¶”ê°€ë¨!`);
}

// â”€â”€ í…Œì´ë¸” ë Œë” â”€â”€
function renderTable(){
  const tbody=document.getElementById("tblBody");
  if(!rows.length){
    tbody.innerHTML=`<tr><td colspan="12" class="tbl-empty">ğŸ”– ë¶ë§ˆí¬ë¦¿ìœ¼ë¡œ ì˜¬ë¦¬ë¸Œì˜ ì œí’ˆì„ ì¶”ê°€í•˜ê±°ë‚˜<br>ì§ì ‘ ì…ë ¥ìœ¼ë¡œ ì œí’ˆì„ ì¶”ê°€í•´ë³´ì„¸ìš”</td></tr>`;
    return;
  }
  tbody.innerHTML=rows.map(r=>`
    <tr>
      <td>${r.image?`<img class="thumb" src="${r.image}" onerror="this.style.display='none'"/>`:`<div class="thumb-ph">ğŸ“¦</div>`}</td>
      <td><input value="${esc(r.name)}" onchange="upd(${r.id},'name',this.value)"/></td>
      <td><input value="${esc(r.brand)}" onchange="upd(${r.id},'brand',this.value)"/></td>
      <td>
        <select onchange="upd(${r.id},'category',this.value)">
          ${CATEGORIES.map(c=>`<option value="${c.id}"${r.category===c.id?" selected":""}>${c.label}</option>`).join("")}
        </select>
      </td>
      <td><input value="${esc(r.ingredient)}" onchange="upd(${r.id},'ingredient',this.value)"/></td>
      <td>
        <div class="chip-group">
          ${SKIN_TYPES.map(s=>`<span class="chip chip-skin${r.skin_types.includes(s)?"":" off"}" onclick="toggleChip(${r.id},'skin_types','${s}')">${s}</span>`).join("")}
        </div>
      </td>
      <td>
        <div class="chip-group">
          ${CONCERNS.map(c=>`<span class="chip chip-concern${r.concerns.includes(c)?"":" off"}" onclick="toggleChip(${r.id},'concerns','${c}')">${c}</span>`).join("")}
        </div>
      </td>
      <td><input type="number" value="${r.price}" onchange="upd(${r.id},'price',this.value)" style="width:60px"/></td>
      <td><input type="number" step="0.1" value="${r.rating}" onchange="upd(${r.id},'rating',this.value)" style="width:46px"/></td>
      <td><input type="number" value="${r.reviews}" onchange="upd(${r.id},'reviews',this.value)" style="width:60px"/></td>
      <td><input value="${esc(r.oliveyoung)}" placeholder="ë§í¬" onchange="upd(${r.id},'oliveyoung',this.value)"/></td>
      <td><button onclick="delRow(${r.id})" style="padding:5px 8px;background:none;border:1px solid var(--bord);border-radius:6px;color:var(--red);font-size:11px;cursor:pointer">ì‚­ì œ</button></td>
    </tr>
  `).join("");
  document.getElementById("tblCnt").textContent=`(${rows.length}ê°œ)`;
}

function esc(s){return String(s||"").replace(/"/g,"&quot;").replace(/</g,"&lt;")}
function upd(id,k,v){const r=rows.find(r=>r.id===id);if(r)r[k]=v;}
function toggleChip(id,key,val){
  const r=rows.find(r=>r.id===id);if(!r)return;
  r[key]=r[key].includes(val)?r[key].filter(x=>x!==val):[...r[key],val];
  renderTable();
}
function delRow(id){rows=rows.filter(r=>r.id!==id);renderTable();updateCount();}
function clearAll(){if(!rows.length||confirm("ì „ì²´ ì´ˆê¸°í™”í• ê¹Œìš”?")){rows=[];renderTable();updateCount();}}
function updateCount(){
  const n=rows.length;
  document.getElementById("bottomCnt").textContent=n;
  document.getElementById("hdrCnt").textContent=`${n}ê°œ ëŒ€ê¸°ì¤‘`;
  document.getElementById("btnSave").disabled=n===0;
  document.getElementById("btnCsv").disabled=n===0;
}

// â”€â”€ Supabase ì €ì¥ â”€â”€
async function saveToSupabase(){
  const url=document.getElementById("sbUrl").value.trim();
  const key=document.getElementById("sbKey").value.trim();
  if(!url||!key){alert("Supabase URLê³¼ Keyë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”!");return;}
  const btn=document.getElementById("btnSave");
  btn.disabled=true;btn.textContent="ì €ì¥ ì¤‘...";
  let ok=0,fail=0;
  for(const r of rows){
    try{
      const res=await fetch(`${url}/rest/v1/products`,{
        method:"POST",
        headers:{"Content-Type":"application/json","apikey":key,"Authorization":`Bearer ${key}`,"Prefer":"return=minimal"},
        body:JSON.stringify({
          category:r.category,name:r.name,brand:r.brand,image:r.image,
          price:Number(r.price)||0,rating:Number(r.rating)||4.5,reviews:Number(r.reviews)||0,
          oliveyoung:r.oliveyoung,ingredient:r.ingredient,
          skin_types:r.skin_types,concerns:r.concerns,tags:r.tags,
        }),
      });
      res.ok?ok++:fail++;
    }catch(e){fail++;}
  }
  btn.disabled=false;btn.innerHTML="â˜ï¸ Supabase ì €ì¥";
  if(fail===0){
    showNotify(`ğŸ‰ ${ok}ê°œ ì €ì¥ ì™„ë£Œ!`);
    rows=[];renderTable();updateCount();
  } else {
    alert(`âœ… ${ok}ê°œ ì„±ê³µ\nâš ï¸ ${fail}ê°œ ì‹¤íŒ¨\n\nRLS ì •ì±…ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`);
  }
}

// â”€â”€ CSV â”€â”€
function exportCSV(){
  const h=["category","name","brand","image","price","rating","reviews","oliveyoung","ingredient","skin_types","concerns","tags"];
  const body=rows.map(r=>[r.category,r.name,r.brand,r.image,r.price,r.rating,r.reviews,r.oliveyoung,r.ingredient,JSON.stringify(r.skin_types),JSON.stringify(r.concerns),JSON.stringify(r.tags)]);
  const csv=[h,...body].map(row=>row.map(c=>{const s=String(c||"");return s.includes(",")||s.includes('"')?`"${s.replace(/"/g,'""')}"`:`${s}`}).join(",")).join("\n");
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob(["\uFEFF"+csv],{type:"text/csv;charset=utf-8"}));
  a.download=`glowie_${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
}

function showNotify(msg){
  const el=document.getElementById("notify");
  el.textContent=msg;el.style.display="block";
  setTimeout(()=>el.style.display="none",3000);
}
</script>
</body>
</html>
